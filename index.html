
<!DOCTYPE html>
<html lang="fr">
<link rel="manifest" href="manifest.json" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Little Secret - Mobile</title>
  <link rel="apple-touch-icon" href="icon.png" />
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px;
      background-color: #f2f2f2;
    }
    #setup {
      display: none;
    }
    #role, #players {
      font-size: 1.8em;
      margin: 10px;
      color: #333;
    }
    #word {
      font-size: 1.8em;
      margin: 10px;
      color: #3037C2;
    }
    button {
      font-size: 1.2em;
      padding: 10px 20px;
      margin-top: 20px;
    }
    input[type=number] {
      font-size: 1.2em;
      padding: 5px;
      width: 80px;
    }
    #timer {
      font-size: 1.5em;
      color: red;
      margin-top: 10px;
    }
    #reveal {
      display: none;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      font-size: 1.4em;
      margin: 5px 0;
    }
    ik {
      font-size: 1.2em;
      margin: 10px;
      color: #333;
    }
  </style>
</head>
<body>

  <div id="start">
    <h1>LITTLE SECRET</h1>
    <h2>3 √† 15 joueurs</h2>
    <p>üë§ Nombre de joueurs :</p>
    <input type="number" id="playerCount" min="3" max="15" value="5"/>
    
    <p>ü´£ Nombre d'infiltr√©s :</p>
    <input type="number" id="spyCount" min="1" max="10" value="1"/>
    
    <p>üïµÔ∏è‚Äç‚ôÇÔ∏è Nombre de journalistes :</p>
    <input type="number" id="journalistCount" min="0" max="10" value="1"/>

    <p>‚è≥ Temps d'affichage du r√¥le :</p>
    <input type="number" id="displayDuration" min="3" max="30" value="10"/>
    
    <div style="display: flex; justify-content: space-between; gap: 1em;">
      <button onclick="openOptions()">Options</button>
      <button onclick="prepareNames()">Nouvelle partie</button>
    </div>
  </div>

  <div id="options" style="display: none;">
  <h2>Modifier les mots</h2>

    <div style="display: flex; gap: 2em;">
      <div style="flex: 1;">
        <h3>Mots des disciples</h3>
        <textarea id="discipleWordsInput" rows="25" style="width: 100%;"></textarea>
      </div>
      <div style="flex: 1;">
        <h3>Mots des infiltr√©s</h3>
        <textarea id="infiltr√©WordsInput" rows="25" style="width: 100%;"></textarea>
      </div>
    </div>
  
    <div style="margin-top: 1em; display: flex; justify-content: center; gap: 1em;">
      <button onclick="restoreDefaultWords()">Restaurer par d√©faut</button>
      <button onclick="saveOptions()">Retour accueil</button>
    </div>
  </div>
  
  <div id="names" style="display:none;">
    <h2>Entrez le nom des joueurs</h2>
    <form id="namesForm"></form>
    <div style="margin-top: 1em; display: flex; justify-content: center; gap: 1em;">
      <button onclick="mainMenu()">Retour accueil</button>
      <button onclick="submitNames()">D√©marrer la partie</button>
    </div>
  </div>

  <div id="setup">
    <h2>Attribution des mots...</h2>
    <div id="players"></div>
    <p id="info">Clique sur le bouton ci-dessous pour d√©couvrir ton mot.</p>
    <div id="word">‚¨õ‚¨õ‚¨õ</div>
    <div id="timer"></div>
    <button id="toggleButton" onclick="toggleRole()">Voir mon mot</button>
  </div>

  <div id="reveal">
    <h2>Phase de r√©v√©lation</h2>
    <p id="revealbis" style="display:none;">Voici comment les r√¥les et les mots ont √©t√© attribu√©s √† chaque joueur dans cette partie :</p>
    <ul id="revealList"></ul>
    <div style="margin-top: 1em; display: flex; justify-content: center; gap: 1em;">
      <button id="menuButton" style="display:none;" onclick="mainMenu()">Retour accueil</button>
      <button id="replayButton" style="display:none;" onclick="restartGame()">Rejouer</button>
    </div>
  </div>

  <script>
    const defaultDiscipleWords = ["Chat", "Avion", "Bouteille", "Lune", "Arbre", "Marteau", "Nuage", "Fromage", "Serpent", "Radio", "Pluie", "T√©l√©phone", "Montagne", "Papier", "√âlectricit√©", "Requin", "Chaise", "Chocolat", "Feu", "Robot"];
    const defaultInfiltr√©Words = ["Tigre", "H√©licopt√®re", "Carafe", "Soleil", "Buisson", "Tournevis", "Fum√©e", "Yaourt", "Anguille", "Enceinte", "Neige", "Talkie-walkie", "Colline", "Carton", "Magn√©tisme", "Dauphin", "Fauteuil", "Nutella", "Braise", "Cyborg"];
    const journalisteMessage = "‚ùå Aucun mot ‚ùå ";
    let discipleWords = [...defaultDiscipleWords];
    let infiltr√©Words = [...defaultInfiltr√©Words];

    let rolesPool = [];
    let motSecret = "";
    let motPiege = "";
    let allRoles = [];
    let revealedRoles = [];
    let currentRole = "";
    let showing = false;
    let timer = null;
    let countdown = 0;
    let displaySeconds = 10;
    let playerNumber = 1;

    function getRandomFromArray(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function openOptions() {
      document.getElementById("start").style.display = "none";
      document.getElementById("options").style.display = "block";
    
      document.getElementById("discipleWordsInput").value = discipleWords.join("\n");
      document.getElementById("infiltr√©WordsInput").value = infiltr√©Words.join("\n");
    }
    
    function saveOptions() {
      const discipleText = document.getElementById("discipleWordsInput").value.trim();
      const infiltr√©Text = document.getElementById("infiltr√©WordsInput").value.trim();
    
      discipleWords = discipleText.split("\n").map(w => w.trim()).filter(w => w.length > 0);
      infiltr√©Words = infiltr√©Text.split("\n").map(w => w.trim()).filter(w => w.length > 0);
    
      if (discipleWords.length !== infiltr√©Words.length) {
        alert("Les deux listes doivent contenir exactement le m√™me nombre de mots !");
        return;
      }
    
      document.getElementById("options").style.display = "none";
      document.getElementById("start").style.display = "block";
    }
    
    function restoreDefaultWords() {
      discipleWords = [...defaultDiscipleWords];
      infiltr√©Words = [...defaultInfiltr√©Words];
    
      document.getElementById("discipleWordsInput").value = discipleWords.join("\n");
      document.getElementById("infiltr√©WordsInput").value = infiltr√©Words.join("\n");
    }

    function mainMenu() {
      document.getElementById("names").style.display = "none";
      document.getElementById("reveal").style.display = "none";
      document.getElementById("start").style.display = "block";
    }
    
    function prepareNames() {
      const totalPlayers = parseInt(document.getElementById("playerCount").value);
      const spyCount = parseInt(document.getElementById("spyCount").value);
      const journalistCount = parseInt(document.getElementById("journalistCount").value);
      displaySeconds = parseInt(document.getElementById("displayDuration").value);
    
      if (spyCount + journalistCount > totalPlayers) {
        alert("Le total des infiltr√©s et journalistes d√©passe le nombre de joueurs !");
        return;
      }
    
      const nameForm = document.getElementById("namesForm");
      nameForm.innerHTML = "";
    
      for (let i = 1; i <= totalPlayers; i++) {
        nameForm.innerHTML += `
          <p>üë§ Joueur ${i} : <input type="text" name="player${i}" required placeholder="Nom ou pseudo"></p>
        `;
      }
    
      document.getElementById("start").style.display = "none";
      document.getElementById("names").style.display = "block";
    
      // Stocke les r√¥les √† pr√©parer
      rolesPool = [];
      for (let i = 0; i < spyCount; i++) rolesPool.push("ü´£ Infiltr√©");
      for (let i = 0; i < journalistCount; i++) rolesPool.push("üïµÔ∏è‚Äç‚ôÇÔ∏è Journaliste");
      for (let i = 0; i < totalPlayers - spyCount - journalistCount; i++) rolesPool.push("ü§ì Disciple");
    
      shuffleArray(rolesPool);
      allRoles = [...rolesPool];
    
      const index = Math.floor(Math.random() * discipleWords.length);
      motSecret = discipleWords[index];
      motPiege = infiltr√©Words[index];
    }

    let playerNames = [];

    function submitNames() {
      const inputs = document.querySelectorAll("#namesForm input");
      playerNames = [];

      for (let input of inputs) {
        if (input.value.trim() === "") {
          alert("Tous les joueurs doivent avoir un nom.");
          return;
        }
        playerNames.push(input.value.trim());
      }

      document.getElementById("names").style.display = "none";
      document.getElementById("setup").style.display = "block";
      document.getElementById("toggleButton").innerText = "Voir mon mot";
      document.getElementById("word").innerText = "‚¨õ‚¨õ‚¨õ";
      document.getElementById("timer").innerText = "";
      showing = false;
      playerNumber = 1;
    }

    function toggleRole() {
      if (!showing) {
        if (rolesPool.length === 0) {
          document.getElementById("setup").style.display = "none";
          document.getElementById("reveal").style.display = "block";
          document.getElementById("revealList").innerHTML = "<li>‚úÖ Tous les r√¥les ont √©t√© distribu√©s. Cliquez sur le bouton ci-dessous pour r√©v√©ler les r√¥les.</li>";
          document.getElementById("revealList").style.fontWeight = "bold";
          const revealBtn = document.createElement("button");
          revealBtn.innerText = "R√©v√©ler tous les r√¥les";
          revealBtn.onclick = showRevealPhase;
          document.getElementById("reveal").appendChild(revealBtn);
          return;
        }

        currentRole = rolesPool.pop();
        const currentName = playerNames[playerNumber - 1];
        revealedRoles.push({ joueur: currentName, role: currentRole });
        playerNumber++;
        let wordShown = "";

        if (currentRole === "ü§ì Disciple") {
          wordShown = motSecret;
        } else if (currentRole === "ü´£ Infiltr√©") {
          wordShown = motPiege;
        } else {
          wordShown = journalisteMessage;
        }

        document.getElementById("players").innerText = `${currentName}`;
        document.getElementById("word").innerText = wordShown;
        document.getElementById("info").innerText = "Souviens-toi de ton mot.";
        document.getElementById("toggleButton").innerText = "Cacher mon mot";
        showing = true;

        startCountdown(displaySeconds);
      } else {
        hideRole();
      }
    }

    function startCountdown(seconds) {
      countdown = seconds;
      document.getElementById("timer").innerText = `Masquage dans ${countdown} secondes...`;

      timer = setInterval(() => {
        countdown--;
        if (countdown <= 0) {
          clearInterval(timer);
          hideRole();
        } else {
          document.getElementById("timer").innerText = `Masquage dans ${countdown} secondes...`;
        }
      }, 1000);
    }

    function hideRole() {
      clearInterval(timer);
      const currentName = playerNames[playerNumber - 1];
      document.getElementById("players").innerText = "";
      document.getElementById("word").innerText = "‚¨õ‚¨õ‚¨õ";
      document.getElementById("info").innerText = `Passe l'appareil √† ${currentName}`;
      document.getElementById("toggleButton").innerText = "Voir mon mot";
      document.getElementById("timer").innerText = "";
      showing = false;
      if (rolesPool.length === 0) {
        document.getElementById("setup").style.display = "none";
        document.getElementById("reveal").style.display = "block";
        document.getElementById("revealList").innerHTML = "<li>‚úÖ Tous les mots ont √©t√© attribu√©s. Cliquez sur le bouton ci-dessous pour r√©v√©ler les r√¥les.</li>";
        document.getElementById("revealList").style.fontWeight = "bold";
        const revealBtn = document.createElement("button");
        revealBtn.innerText = "R√©v√©ler tous les r√¥les";
        revealBtn.onclick = showRevealPhase;
        document.getElementById("reveal").appendChild(revealBtn);
      }
    }

    function showRevealPhase() {
      document.getElementById("setup").style.display = "none";
      document.getElementById("reveal").style.display = "block";
      document.getElementById("revealbis").style.display = "block";
      const list = document.getElementById("revealList");
      list.innerHTML = "";
      revealedRoles.forEach((entry, index) => {
        let word = entry.role === "ü§ì Disciple" ? motSecret :
                   entry.role === "ü´£ Infiltr√©" ? motPiege :
                   "Aucun";
        list.innerHTML += `<li>üë§ ${entry.joueur}</li>`;
        list.innerHTML += `<ik> ${entry.role} ‚Äî ${word}</ik>`;
      });
      const oldRevealBtn = document.querySelector("#reveal button:not(#replayButton)");
        if (oldRevealBtn) oldRevealBtn.remove();
      document.getElementById("menuButton").style.display = "inline-block";
      document.getElementById("replayButton").style.display = "inline-block";
      
    }
    
    function restartGame() {
      rolesPool = [];
      revealedRoles = [];
      playerNumber = 1;
    
      // R√©utilise les m√™mes r√¥les et noms de joueurs
      shuffleArray(allRoles);
      rolesPool = [...allRoles];
    
      // Rechoisit un mot correspondant √† l'index commun
      const index = Math.floor(Math.random() * discipleWords.length);
      motSecret = discipleWords[index];
      motPiege = infiltr√©Words[index];
    
      // Affiche l'√©cran de distribution
      const currentName = playerNames[playerNumber - 1];
      document.getElementById("reveal").style.display = "none";
      document.getElementById("setup").style.display = "block";
      document.getElementById("toggleButton").innerText = "Voir mon mot";
      document.getElementById("word").innerText = "‚¨õ‚¨õ‚¨õ";
      document.getElementById("info").innerText = `Passe l'appareil √† ${currentName}`;
      document.getElementById("timer").innerText = "";
      showing = false;
      document.getElementById("replayButton").style.display = "none";
    }
    
  </script>

</body>
</html>
