
<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Little Secret - Mobile</title>
  <link rel="apple-touch-icon" href="icon.png" />
  <style>
    body {
      background-color: #111827;
      color: #F3F4F6;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
      
    h1, h2, h3 {
      color: #60A5FA;
      margin-bottom: 0.5em;
    }
    
    input[type="number"] {
        padding: 10px;
        border-radius: 5px;
        margin: 5px 0;
        width: 45%;
        font-size: 1em;
        background-color: #1F2937;
        color: #F3F4F6;
        text-align: center;
      }
      
      input[type="text"], textarea {
              padding: 5px;
              border-radius: 5px;
              margin: 5px 0;
              width: 45%;
              font-size: 1em;
              background-color: #111827;
              color: #F3F4F6;
              text-align: center;
            }
    
      button {
        padding: 10px 20px;
        margin: 10px;
        border-radius: 5px;
        border: none;
        background-color: #60A5FA;
        color: #111827;
        font-size: 1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
      }
    
      button.clicked {
        background-color: #3B82F6 !important;
        box-shadow: 0 0 10px #3B82F6aa;
      }
    
      textarea {
        resize: vertical;
        min-height: 150px;
      }
      
    #setup, #reveal {
      display: none;
      max-width: 600px;
      margin: auto;
      background-color: #1F2937;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #00000088;
    }
    #names, #options {
      max-width: 600px;
      margin: auto;
      background-color: #1F2937;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 0 10px #00000088;
    }

    #role, #word, #players {
      font-size: 2em;
      margin-top: 10px;
      font-weight: bold;
    }
    #timer {
      color: #FBBF24;
      font-weight: bold;
      margin-top: 10px;
    }
    
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      font-size: 1.4em;
      margin: 5px 0;
    }
    
  </style>
</head>
<body>

  <div id="start">
    <h1>LITTLE SECRET</h1>
    <h2>3 √† 15 joueurs</h2>
    <p>üë§ Nombre de joueurs :</p>
    <input type="number" id="playerCount" min="3" max="15" value="5"/>
    
    <p>ü´£ Nombre d'infiltr√©s :</p>
    <input type="number" id="spyCount" min="1" max="10" value="1"/>
    
    <p>üïµÔ∏è‚Äç‚ôÇÔ∏è Nombre de journalistes :</p>
    <input type="number" id="journalistCount" min="0" max="10" value="1"/>

    <p>‚è≥ Temps d'affichage du r√¥le :</p>
    <input type="number" id="displayDuration" min="3" max="30" value="10"/>
    
    <div style="display: flex; justify-content: space-between; gap: 1em;">
      <button onclick="openOptions()">Options</button>
      <button onclick="prepareNames()">Nouvelle partie</button>
    </div>
  </div>

  <div id="options" style="display: none;">
  <h2>Modifier les mots</h2>

    <label for="difficultySelect">Choisir la difficult√© :</label>
    <select id="difficultySelect" onchange="updateWordEditor()">
      <option value="facile">Facile</option>
      <option value="interm√©diaire">Interm√©diaire</option>
      <option value="difficile">Difficile</option>
      <option value="personnalis√©e">Personnalis√©e</option>
    </select>
    <div style="display: flex; gap: 1em; margin-top: 1em;">
      <div style="flex: 1;">
        <h3>Disciples</h3>
        <textarea id="discipleWordsInput" rows="20" style="width: 90%;"></textarea>
      </div>
      <div style="flex: 1;">
        <h3>Infiltr√©s</h3>
        <textarea id="infiltr√©WordsInput" rows="20" style="width: 90%;"></textarea>
      </div>
    </div>
    
    <div style="margin-top: 1em; display: flex; justify-content: center; gap: 1em;">
      <button onclick="saveOptions()">Sauvegarder</button>
    </div>
  </div>
  
  <div id="names" style="display:none;">
    <h2>Entrez le nom des joueurs</h2>
    <form id="namesForm"></form>
    <div style="text-align: center; margin-bottom: 1em;">
      <button onclick="clearSavedNames()">Effacer les noms enregistr√©s</button>
    </div>
    <div style="margin-top: 1em; display: flex; justify-content: center; gap: 1em;">
      <button onclick="mainMenu()">Retour accueil</button>
      <button onclick="submitNames()">D√©marrer la partie</button>
    </div>
  </div>

  <div id="setup">
    <h2>Attribution des mots...</h2>
    <div id="players"></div>
    <p id="info">Clique sur le bouton ci-dessous pour d√©couvrir ton mot.</p>
    <div id="word">‚¨õ‚¨õ‚¨õ</div>
    <div id="timer"></div>
    <button id="toggleButton" onclick="toggleRole()">Voir mon mot</button>
  </div>

  <div id="reveal">
    <h2>Phase de r√©v√©lation</h2>
    <p id="revealbis" style="display:none;">Voici comment les r√¥les et les mots ont √©t√© attribu√©s √† chaque joueur dans cette partie :</p>
    <ul id="revealList"></ul>
    <button id="replayButton" style="display:none;" onclick="restartGame()">Rejouer</button>
  </div>

  <script>
    const wordLists = {
      facile: {
        disciples: ["Chat", "Avion", "Bouteille", "Lune", "Arbre", "Marteau", "Nuage", "Fromage", "Serpent", "Radio", "Pluie", "T√©l√©phone", "Montagne", "Papier", "√âlectricit√©", "Requin", "Chaise", "Chocolat", "Feu", "Robot"],
        infiltrees: ["Tigre", "H√©licopt√®re", "Carafe", "Soleil", "Buisson", "Tournevis", "Fum√©e", "Yaourt", "Anguille", "Enceinte", "Neige", "Talkie-walkie", "Colline", "Carton", "Magn√©tisme", "Dauphin", "Fauteuil", "Nutella", "Braise", "Cyborg"]
      },
      interm√©diaire: {
        disciples: ["Musique", "Banque", "Montagne", "Ordinateur", "Plage"],
        infiltrees: ["Chanson", "Argent", "Colline", "√âcran", "Sable"]
      },
      difficile: {
        disciples: ["M√©taphore", "Abstraction", "√âthique", "Philosophie", "Conscience"],
        infiltrees: ["Comparaison", "Concret", "Morale", "Id√©ologie", "Subconscient"]
      },
      personnalis√©e: {
        disciples: [],
        infiltrees: []
      }
    };
    
    let selectedDifficulty = "facile";
    const journalisteMessage = "‚ùå Aucun mot ‚ùå ";

    let rolesPool = [];
    let motSecret = "";
    let motPiege = "";
    let allRoles = [];
    let revealedRoles = [];
    let currentRole = "";
    let showing = false;
    let timer = null;
    let countdown = 0;
    let displaySeconds = 10;
    let playerNumber = 1;

    function getRandomFromArray(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function openOptions() {
      document.getElementById("start").style.display = "none";
      document.getElementById("options").style.display = "block";
    
      document.getElementById("difficultySelect").value = selectedDifficulty;
      updateWordEditor();
    }
    
    function updateWordEditor() {
      selectedDifficulty = document.getElementById("difficultySelect").value;
    
      const discipleArea = document.getElementById("discipleWordsInput");
      const infilArea = document.getElementById("infiltr√©WordsInput");
    
      const list = wordLists[selectedDifficulty];
    
      discipleArea.value = list.disciples.join("\n");
      infilArea.value = list.infiltrees.join("\n");
    
      const editable = selectedDifficulty === "personnalis√©e";
      discipleArea.disabled = !editable;
      infilArea.disabled = !editable;
    }
    
    function saveOptions() {
      if (selectedDifficulty === "personnalis√©e") {
        const discipleText = document.getElementById("discipleWordsInput").value.trim();
        const infilText = document.getElementById("infiltr√©WordsInput").value.trim();
    
        wordLists.personnalis√©e.disciples = discipleText.split("\n").map(w => w.trim()).filter(w => w);
        wordLists.personnalis√©e.infiltrees = infilText.split("\n").map(w => w.trim()).filter(w => w);
    
        // Sauvegarde locale
        localStorage.setItem("customDisciples", JSON.stringify(wordLists.personnalis√©e.disciples));
        localStorage.setItem("customInfiltrees", JSON.stringify(wordLists.personnalis√©e.infiltrees));
      }
    
      document.getElementById("options").style.display = "none";
      document.getElementById("start").style.display = "block";
      
      localStorage.setItem("selectedDifficulty", selectedDifficulty);
    }
    
    function restoreDefaultWords() {
      discipleWords = [...defaultDiscipleWords];
      infiltr√©Words = [...defaultInfiltr√©Words];
    
      localStorage.removeItem("discipleWords");
      localStorage.removeItem("infiltr√©Words");
    
      document.getElementById("discipleWordsInput").value = discipleWords.join("\n");
      document.getElementById("infiltr√©WordsInput").value = infiltr√©Words.join("\n");
    }

    function mainMenu() {
      document.getElementById("names").style.display = "none";
      document.getElementById("start").style.display = "block";
    }
    
    function prepareNames() {
      const totalPlayers = parseInt(document.getElementById("playerCount").value);
      const spyCount = parseInt(document.getElementById("spyCount").value);
      const journalistCount = parseInt(document.getElementById("journalistCount").value);
      displaySeconds = parseInt(document.getElementById("displayDuration").value);
    
      if (spyCount + journalistCount > totalPlayers) {
        alert("Le total des infiltr√©s et journalistes d√©passe le nombre de joueurs !");
        return;
      }
    
      const nameForm = document.getElementById("namesForm");
      nameForm.innerHTML = "";
      const savedNames = JSON.parse(localStorage.getItem("playerNames") || "[]");
    
      for (let i = 1; i <= totalPlayers; i++) {
        const value = savedNames[i - 1] ? `value="${savedNames[i - 1]}"` : "";
        nameForm.innerHTML += `
          <p>Joueur ${i} : <input type="text" name="player${i}" required placeholder="Nom ou pseudo" ${value}></p>
        `;
      }
    
      document.getElementById("start").style.display = "none";
      document.getElementById("names").style.display = "block";
    
      // Stocke les r√¥les √† pr√©parer
      rolesPool = [];
      for (let i = 0; i < spyCount; i++) rolesPool.push("ü´£ Infiltr√©");
      for (let i = 0; i < journalistCount; i++) rolesPool.push("üïµÔ∏è‚Äç‚ôÇÔ∏è Journaliste");
      for (let i = 0; i < totalPlayers - spyCount - journalistCount; i++) rolesPool.push("ü§ì Disciple");
    
      shuffleArray(rolesPool);
      allRoles = [...rolesPool];
    
      const list = wordLists[selectedDifficulty];
      const index = Math.floor(Math.random() * list.disciples.length);
      motSecret = list.disciples[index];
      motPiege = list.infiltrees[index];
    }

    let playerNames = [];

    function submitNames() {
      const inputs = document.querySelectorAll("#namesForm input");
      playerNames = [];

      for (let input of inputs) {
        if (input.value.trim() === "") {
          alert("Tous les joueurs doivent avoir un nom.");
          return;
        }
        playerNames.push(input.value.trim());
        localStorage.setItem("playerNames", JSON.stringify(playerNames));
      }

      document.getElementById("names").style.display = "none";
      document.getElementById("setup").style.display = "block";
      document.getElementById("toggleButton").innerText = "Voir mon mot";
      document.getElementById("word").innerText = "‚¨õ‚¨õ‚¨õ";
      document.getElementById("timer").innerText = "";
      showing = false;
      playerNumber = 1;
    }
    
    function clearSavedNames() {
      localStorage.removeItem("playerNames");
    
      const inputs = document.querySelectorAll("#namesForm input");
      inputs.forEach(input => input.value = "");
    }
    
    function toggleRole() {
      document.getElementById("toggleButton").disabled = true; // √©vite double clic
      setTimeout(() => {
        handleToggleClick();
        document.getElementById("toggleButton").disabled = false;
      }, 500); // d√©lai de 500ms
    }

    function handleToggleClick() {
      if (!showing) {
        if (rolesPool.length === 0) {
          document.getElementById("setup").style.display = "none";
          document.getElementById("reveal").style.display = "block";
          document.getElementById("revealList").innerHTML = "<li>‚úÖ Tous les r√¥les ont √©t√© distribu√©s. Cliquez sur le bouton ci-dessous pour r√©v√©ler les r√¥les.</li>";
          document.getElementById("revealList").style.fontWeight = "bold";
          const revealBtn = document.createElement("button");
          revealBtn.innerText = "R√©v√©ler tous les r√¥les";
          revealBtn.onclick = showRevealPhase;
          document.getElementById("reveal").appendChild(revealBtn);
          return;
        }

        currentRole = rolesPool.pop();
        const currentName = playerNames[playerNumber - 1];
        revealedRoles.push({ joueur: currentName, role: currentRole });
        playerNumber++;
        let wordShown = "";

        if (currentRole === "ü§ì Disciple") {
          wordShown = motSecret;
        } else if (currentRole === "ü´£ Infiltr√©") {
          wordShown = motPiege;
        } else {
          wordShown = journalisteMessage;
        }

        document.getElementById("players").innerText = `${currentName}`;
        document.getElementById("word").innerText = wordShown;
        document.getElementById("info").innerText = "Souviens-toi de ton mot.";
        document.getElementById("toggleButton").innerText = "Cacher mon mot";
        showing = true;

        startCountdown(displaySeconds);
      } else {
        hideRole();
      }
    }

    function startCountdown(seconds) {
      countdown = seconds;
      document.getElementById("timer").innerText = `Masquage dans ${countdown} secondes...`;

      timer = setInterval(() => {
        countdown--;
        if (countdown <= 0) {
          clearInterval(timer);
          hideRole();
        } else {
          document.getElementById("timer").innerText = `Masquage dans ${countdown} secondes...`;
        }
      }, 1000);
    }

    function hideRole() {
      clearInterval(timer);
      const currentName = playerNames[playerNumber - 1];
      document.getElementById("players").innerText = "";
      document.getElementById("word").innerText = "‚¨õ‚¨õ‚¨õ";
      document.getElementById("info").innerText = `Passe l'appareil √† ${currentName}`;
      document.getElementById("toggleButton").innerText = "Voir mon mot";
      document.getElementById("timer").innerText = "";
      showing = false;
      if (rolesPool.length === 0) {
        document.getElementById("setup").style.display = "none";
        document.getElementById("reveal").style.display = "block";
        document.getElementById("revealList").innerHTML = "<li>‚úÖ Tous les mots ont √©t√© attribu√©s. Cliquez sur le bouton ci-dessous pour r√©v√©ler les r√¥les.</li>";
        document.getElementById("revealList").style.fontWeight = "bold";
        const revealBtn = document.createElement("button");
        revealBtn.innerText = "R√©v√©ler tous les r√¥les";
        revealBtn.onclick = showRevealPhase;
        document.getElementById("reveal").appendChild(revealBtn);
      }
    }

    function showRevealPhase() {
      document.getElementById("setup").style.display = "none";
      document.getElementById("reveal").style.display = "block";
      document.getElementById("revealbis").style.display = "block";
      const list = document.getElementById("revealList");
      list.innerHTML = "";
      revealedRoles.forEach((entry, index) => {
        let word = entry.role === "ü§ì Disciple" ? motSecret :
                   entry.role === "ü´£ Infiltr√©" ? motPiege :
                   "Aucun";
        list.innerHTML += `<li>üë§ ${entry.joueur}</li>`;
        list.innerHTML += `<h3> ${entry.role} ‚Äî ${word}</h3>`;
      });
      const oldRevealBtn = document.querySelector("#reveal button:not(#replayButton)");
        if (oldRevealBtn) oldRevealBtn.remove();
      document.getElementById("replayButton").style.display = "inline-block";
      
    }
    
    function restartGame() {
      rolesPool = [];
      revealedRoles = [];
      playerNumber = 1;
    
      // R√©utilise les m√™mes r√¥les et noms de joueurs
      shuffleArray(allRoles);
      rolesPool = [...allRoles];
    
      // Rechoisit un mot correspondant √† l'index commun
      const list = wordLists[selectedDifficulty];
      const index = Math.floor(Math.random() * list.disciples.length);
      motSecret = list.disciples[index];
      motPiege = list.infiltrees[index];
    
      // Affiche l'√©cran de distribution
      const currentName = playerNames[playerNumber - 1];
      document.getElementById("reveal").style.display = "none";
      document.getElementById("setup").style.display = "block";
      document.getElementById("toggleButton").innerText = "Voir mon mot";
      document.getElementById("word").innerText = "‚¨õ‚¨õ‚¨õ";
      document.getElementById("info").innerText = `Passe l'appareil √† ${currentName}`;
      document.getElementById("timer").innerText = "";
      showing = false;
      document.getElementById("replayButton").style.display = "none";
    }
    
    window.onload = function () {
      const savedCustomD = localStorage.getItem("customDisciples");
      const savedCustomI = localStorage.getItem("customInfiltrees");
      
      if (savedCustomD && savedCustomI) {
        try {
          wordLists.personnalis√©e.disciples = JSON.parse(savedCustomD);
          wordLists.personnalis√©e.infiltrees = JSON.parse(savedCustomI);
        } catch (e) {
          console.warn("Erreur lors du chargement des mots personnalis√©s", e);
        }
      }
      
      const savedDifficulty = localStorage.getItem("selectedDifficulty");
      if (savedDifficulty && wordLists[savedDifficulty]) {
        selectedDifficulty = savedDifficulty;
      }
    };
    
    document.querySelectorAll("button").forEach(btn => {
      btn.addEventListener("click", () => {
        btn.classList.add("clicked");
        setTimeout(() => btn.classList.remove("clicked"), 150);
      });
    });
  </script>

</body>
</html>
